#!/bin/bash

# Write selected release to config
if [ "$release" = "stable" ]; then
    sudo sh -c 'echo "deb http://ppa.hornet.zone stable main" > /etc/apt/sources.list.d/hornet.list'
fi
if [ "$release" = "testing" ]; then
    sudo sh -c 'echo "deb http://ppa.hornet.zone stable main" > /etc/apt/sources.list.d/hornet.list'
    sudo sh -c 'echo "deb http://ppa.hornet.zone testing main" >> /etc/apt/sources.list.d/hornet.list'
    sudo sh -c 'echo "deb http://ppa.hornet.zone alpha main" >> /etc/apt/sources.list.d/hornet.list'
fi

# Check if release is changed
if [ "$release" != "$currentrelease" ]; then
    sudo apt -qq purge hornet -y > /dev/null 2>&1
    sudo apt -qq update > /dev/null 2>&1
    sudo apt -qq dist-upgrade -y > /dev/null 2>&1
    sudo apt -qq upgrade -y > /dev/null 2>&1
    sudo systemctl restart hornet
    sudo sed -i 's/dbplock=.*/dbplock=false/' $logs/dbpruner
    sudo sed -i 's/pruningmultiplier=.*/pruningmultiplier=/' $logs/dbpruner
    sudo sed -i 's/pruningdt=.*/pruningdt=/' $logs/dbpruner
fi

# Check if network changed
if [ "$network" != "$currentnetwork" ]; then
    if [ "$network" = "mainnet" ]; then
        echo "" > /etc/default/hornet
    fi
    if [ "$network" = "comnet" ]; then
        echo "OPTIONS=\"--config config_comnet --overwriteCooAddress\"" > /etc/default/hornet
    fi
    if [ "$network" = "devnet" ]; then
        echo "OPTIONS=\"--config config_devnet --overwriteCooAddress\"" > /etc/default/hornet
    fi
    sudo rm -rf $hornetdir/snapshots/mainnet/export.bin $hornetdir/snapshots/comnet/export.bin $hornetdir/snapshots/devnet/export.bin $hornetdir/export.bin $hornetdir/export_comnet.bin $hornetdir/export_devnet.bin
    sudo sed -i 's/dbplock=.*/dbplock=false/' $logs/dbpruner
    sudo sed -i 's/pruningmultiplier=.*/pruningmultiplier=/' $logs/dbpruner
    sudo sed -i 's/pruningdt=.*/pruningdt=/' $logs/dbpruner
fi