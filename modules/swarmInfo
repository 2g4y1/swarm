#!/bin/bash
status="$(systemctl show -p ActiveState --value $node)"

if [ "$apiProtection" = "true" ]; then
    if [ "$apiPort" = "443" ]; then
        dashboardurl="https://$domain"
        apiurl="https://$domain/auth"
    else
        dashboardurl="https://$domain:$apiPort"
        apiurl="https://$domain:$apiPort/auth"
    fi
else if [ "$apiProtection" = "false" ]; then
        if [ "$apiPort" = "443" ]; then
            dashboardUrl="https://$domain"
            apiUrl="https://$domain/access"
        else
            dashboardUrl="https://$domain:$apiPort"
            apiUrl="https://$domain:$apiPort/access"
        fi
    else
        dashboardUrl="N/A"
        apiUrl="N/A"
    fi
fi

nodeVersion="$(curl -s -X GET "http://localhost:14265/api/v1/info" -H  "accept: application/json"|jq '.data.version')"
if [ -z "$nodeVersion" ]; then
    nodeVersion="N/A"
fi
healthy="$(curl -s -X GET "http://localhost:14265/api/v1/info" -H  "accept: application/json"|jq '.data.isHealthy')"
if [ -z "$healthy" ]; then
    healthy="N/A"
fi

if [ "$autoUpdate" = "true" ]; then
    autoUpdateValue=enabled
else
    autoUpdateValue=disabled
fi

# Sync Check
if [ "$checksync" = "true" ]; then
    checkSyncValue=enabled
else
    checkSyncValue=disabled
fi

if [ -z "$pruningDate" ]; then
    pruningDate="N/A"
fi

# Proxy Check
if [ "$proxyCheck" = "true" ]; then
    proxyCheckValue=enabled
else
    proxyCheckValue=disabled
fi

if [ -z "$restartDate" ]; then
    restartDate="N/A"
fi

# Log Pruning
if [ "$logPruning" = "true" ]; then
    logPruning=enabled
else
    logPruning=disabled
fi

# DB size
if [ -d "$hornetDir/${network}db" ] && [ "$node" = "hornet" ]; then
    getCurrentDbSize="$(du -sb $hornetDir/${network}db/tangle.db | cut -f1)"
    let getCurrentDbSizeInGb=$getCurrentDbSize/1000000000
    if [ "$getCurrentDbSizeInGb" -le "0" ]; then
        let getCurrentDbSizeInMb=$getCurrentDbSize/1000000
        currentDbSize="$getCurrentDbSizeInMb MB"
    else
        currentDbSize="$getCurrentDbSizeInGb GB"
    fi
else
    currentDbSize="N/A"
fi

# OUTPUT
whiptail --title "SWARM Info [v$version]" --msgbox "Hornet: v$nodeVersion\nNetwork: $network\nHealthy: $healthy\nDB size: $currentDbSize\n\nWatchdog: $watchdog\nAuto-updater: $autoUpdateValue\nSync-check: $checkSyncValue\nProxy-check: $proxyCheckValue\nLogpruning: $logPruning\nLast restart: $restartDate\n\nDBPruner: $dbPruner\nLast pruning: $pruningDate\n\nDash-URL: $dashboardUrl\nAPI-URL: $apiUrl" 23 65

