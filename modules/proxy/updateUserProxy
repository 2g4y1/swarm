#!/bin/bash

if [ -d "/etc/nginx" ]; then
    if [ ! -f "$configs/.api_htpasswd" ]; then
        sudo touch $configs/.api_htpasswd
    fi
else
    whiptail --title "Proxy Menu" --msgbox "Please deploy the reverse proxy first!" 8 65
fi

newUsername=$(whiptail --inputbox "Please enter a username:" 8 65 --title "Proxy Menu" 3>&1 1>&2 2>&3)
if [ ! -z $newUsername ]; then
    newUserPw=$(whiptail --passwordbox "Please enter a secure password:" 8 65 --title "Proxy Menu" 3>&1 1>&2 2>&3)
    if [[ $newUserPw =~ [[:alpha:]] || $newUserPw =~ [[:digit:]] ]]; then
            updateUserApi=$(htpasswd -Bb $configs/.api_htpasswd $newUsername $newUserPw 2>&1)
            sudo systemctl reload nginx
            whiptail --title "Proxy Menu" --msgbox "$updateUserApi" 8 65
    else
        whiptail --title "Proxy Menu" --msgbox "The password can only contain a-Z and 0-9 as characters!" 8 65
    fi
else
    whiptail --title "Proxy Menu" --msgbox "Please set a username!" 8 65
fi

# Unset all var
unset newUsername
unset newUserPw