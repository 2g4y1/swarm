#!/bin/bash

if [ -d "$plugins/proxy" ] && [ -d "/etc/nginx" ]; then
    if [ ! -f "$plugins/proxy/dashboard_htpasswd" ]; then
        sudo touch $plugins/proxy/dashboard_htpasswd
    fi
    if [ ! -f "$plugins/proxy/api_htpasswd" ]; then
        sudo touch $plugins/proxy/api_htpasswd
    fi
else
    whiptail --title "Proxy Menu" --msgbox "Please deploy the reverse proxy first!" 8 65
fi

CHOICE=$(
    whiptail --title "Proxy Menu" --menu "\nChoose an option:" 20 65 10 \
    "1)" "Edit dashboard user" \
    "2)" "Edit API user" 3>&2 2>&1 1>&3
)

case $CHOICE in
    "1)")
        sudo nano $plugins/proxy/dashboard_htpasswd
        sudo systemctl reload nginx
        whiptail --title "Proxy Menu" --msgbox "Dashboard authentication updated!" 8 65
    ;;
    "2)")
        sudo nano $plugins/proxy/api_htpasswd
        sudo systemctl reload nginx
        whiptail --title "Proxy Menu" --msgbox "API authentication updated!" 8 65
    ;;
esac