#!/bin/bash
if grep -q "\# identity" $beeHome/config.chrysalis-$beeNetwork.toml
then
    sudo sed -i 's~^# identity.*~identity   = ""~' $beeHome/config.chrysalis-$beeNetwork.toml
fi

if [ -z "$beeIdentity" ]; then
    source $beeModules/beeVersion
    if [ $beeVersionNumber -ge 30 ] 2>/dev/null; then
        beeIdentity=$(/usr/bin/bee p2p-identity | head -n 1 | awk '{ print $4 }')
    else
        beeIdentity=$(/usr/bin/bee p2p-identity | head -n 1 | awk '{ print $5 }')
    fi
    sudo sed -i 's~^beeIdentity=.*~beeIdentity="'$beeIdentity'"~' $swarmConfigs/bee.cfg
fi

parser=$(sed -n '/^identity/p' $beeHome/config.chrysalis-$beeNetwork.toml | awk '{ print $3 }')
parser=$(echo $parser | tr -d '"')
if [ "$parser" != "$beeIdentity" ]; then
    sudo sed -i 's~^identity.*~identity   = "'$beeIdentity'"~g' $beeHome/config.chrysalis-$beeNetwork.toml
    restartBee=true
fi