#!/bin/bash

if [ -z "$beeIdentity" ]; then
    if [ ! -f "$beeHome/identity.key" ]; then
        sudo systemctl stop bee
        sudo rm -rf $beeHome/identity.key > /dev/null 2>&1
        sudo systemctl start bee
        if [ ! -f "$beeHome/identity.key" ]; then
            beeIdentity=$(cat $beeHome/identity.key | sed -n '2 p')
            sudo sed -i 's~^beeIdentity=.*~beeIdentity="'$beeIdentity'"~' $swarmConfigs/bee.cfg
        fi
    else
        beeIdentity=$(cat $beeHome/identity.key | sed -n '2 p')
        sudo sed -i 's~^beeIdentity=.*~beeIdentity="'$beeIdentity'"~' $swarmConfigs/bee.cfg
    fi
fi

parser=$(cat $beeHome/identity.key | sed -n '2 p')
if [ "$parser" != "$beeIdentity" ]; then
    sed -i '2 s~.*~'$beeIdentity'~' $beeHome/identity.key
    restartBee=true
fi
