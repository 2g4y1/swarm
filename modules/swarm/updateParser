#!/bin/bash

if [ -f "$configs/hornetCfgBak" ]; then
    source $configs/hornetCfgBak
    # Upater for Hornet.cfg
    if [ -z "$release" ]; then
        sudo sed -i 's/release=.*/release="stable"/' $configs/hornet.cfg
    else
        sudo sed -i 's/release=.*/release="'$release'"/' $configs/hornet.cfg
    fi

    if [ -z "$network" ]; then
        sudo sed -i 's/network=.*/network="mainnet"/' $configs/hornet.cfg
    else
        sudo sed -i 's/network=.*/network="'$network'"/' $configs/hornet.cfg
    fi

    if [ -z "$nodeAlias" ]; then
        sudo sed -i 's/nodeAlias=.*/nodeAlias="Hornet"/' $configs/hornet.cfg
    else
        sudo sed -i 's/nodeAlias=.*/nodeAlias="'$nodeAlias'"/' $configs/hornet.cfg
    fi

    if [ -z "$disablePlugins" ]; then
        sudo sed -i 's/disablePlugins=.*/disablePlugins=""/' $configs/hornet.cfg
    else
        sudo sed -i 's/disablePlugins=.*/disablePlugins="'$disablePlugins'"/' $configs/hornet.cfg
    fi

    if [ -z "$enablePlugins" ]; then
        sudo sed -i 's/enablePlugins=.*/enablePlugins=""/' $configs/hornet.cfg
    else
        sudo sed -i 's/enablePlugins=.*/enablePlugins="'$enablePlugins'"/' $configs/hornet.cfg
    fi

    if [ -z "$maxUnknownNeighbors" ]; then
        sudo sed -i 's/maxUnknownNeighbors=.*/maxUnknownNeighbors=4/' $configs/hornet.cfg
    else
        sudo sed -i 's/maxUnknownNeighbors=.*/maxUnknownNeighbors='$maxUnknownNeighbors'/' $configs/hornet.cfg
    fi

    if [ -z "$lsDelay" ]; then
        sudo sed -i 's/lsDelay=.*/lsDelay=1000/' $configs/hornet.cfg
    else
        sudo sed -i 's/lsDelay=.*/lsDelay='$lsDelay'/' $configs/hornet.cfg
    fi

    if [ -z "$neighborPort" ]; then
        sudo sed -i 's/neighborPort=.*/neighborPort=15600/' $configs/hornet.cfg
    else
        sudo sed -i 's/neighborPort=.*/neighborPort='$neighborPort'/' $configs/hornet.cfg
    fi

    if [ -z "$pow" ]; then
        sudo sed -i 's/pow=.*/pow=true/' $configs/hornet.cfg
    else
        sudo sed -i 's/pow=.*/pow='$pow'/' $configs/hornet.cfg
    fi

    if [ -z "$powWorkers" ]; then
        sudo sed -i 's/powWorkers=.*/powWorkers=1/' $configs/hornet.cfg
    else
        sudo sed -i 's/powWorkers=.*/powWorkers='$powWorkers'/' $configs/hornet.cfg
    fi

    if [ -z "$dbEngine" ]; then
        sudo sed -i 's/dbEngine=.*/dbEngine="rocksdb"/' $configs/hornet.cfg
    else
        sudo sed -i 's/dbEngine=.*/dbEngine="'$dbEngine'"/' $configs/hornet.cfg
    fi

    if [ -z "$autoRevalidation" ]; then
        sudo sed -i 's/autoRevalidation=.*/autoRevalidation=false/' $configs/hornet.cfg
    else
        sudo sed -i 's/autoRevalidation=.*/autoRevalidation='$autoRevalidation'/' $configs/hornet.cfg
    fi

    if [ -z "$pruning" ]; then
        sudo sed -i 's/pruning=.*/pruning=true/' $configs/hornet.cfg
    else
        sudo sed -i 's/pruning=.*/pruning='$pruning'/' $configs/hornet.cfg
    fi

    if [ -z "$pruningDelay" ]; then
        sudo sed -i 's/pruningDelay=.*/pruningDelay=60480/' $configs/hornet.cfg
    else
        sudo sed -i 's/pruningDelay=.*/pruningDelay='$pruningDelay'/' $configs/hornet.cfg
    fi

    if [ -z "$username" ]; then
        sudo sed -i 's/username=.*/username=""/' $configs/hornet.cfg
    else
        sudo sed -i 's/username=.*/username="'$username'"/' $configs/hornet.cfg
    fi

    if [ -z "$passwordHash" ]; then
        sudo sed -i 's/passwordHash=.*/passwordHash=""/' $configs/hornet.cfg
    else
        sudo sed -i 's/passwordHash=.*/passwordHash="'$passwordHash'"/' $configs/hornet.cfg
    fi

    if [ -z "$passwordSalt" ]; then
        sudo sed -i 's/passwordSalt=.*/passwordSalt=""/' $configs/hornet.cfg
    else
        sudo sed -i 's/passwordSalt=.*/passwordSalt="'$passwordSalt'"/' $configs/hornet.cfg
    fi

    if [ -z "$p2pIdentity" ]; then
        sudo sed -i 's/p2pIdentity=.*/p2pIdentity=""/' $configs/hornet.cfg
    else
        sudo sed -i 's/p2pIdentity=.*/p2pIdentity="'$p2pIdentity'"/' $configs/hornet.cfg
    fi

    if [ -z "$validation" ]; then
        sudo sed -i 's/validation=.*/validation=false/' $configs/hornet.cfg
    else
        sudo sed -i 's/validation=.*/validation='$validation'/' $configs/hornet.cfg
    fi

    if [ -z "$validationLog" ]; then
        sudo sed -i 's/validationLog=.*/validationLog=false/' $configs/hornet.cfg
    else
        sudo sed -i 's/validationLog=.*/validationLog='$validationLog'/' $configs/hornet.cfg
    fi

    # Delete Bak file
    rm -rf $configs/hornetCfgBak
fi

####################################################################################################################################

if [ -f "$configs/proxyCfgBak" ]; then
    source $configs/proxyCfgBak
    # Upater for Nginx.cfg
    if [ -z "$domain" ]; then
        sudo sed -i 's/domain=.*/domain="myhornetnode.ddns.net"/' $configs/proxy.cfg
    else
        sudo sed -i 's/domain=.*/domain="'$domain'"/' $configs/proxy.cfg
    fi

    if [ -z "$apiPort" ]; then
        sudo sed -i 's/apiPort=.*/apiPort=443/' $configs/proxy.cfg
    else
        sudo sed -i 's/apiPort=.*/apiPort='$apiPort'/' $configs/proxy.cfg
    fi

    # Delete Bak file
    rm -rf $configs/proxyCfgBak
fi

####################################################################################################################################

if [ -f "$configs/swarmCfgBak" ]; then
    source $configs/swarmCfgBak
    # Upater for SWARM.cfg
    if [ -z "$updateNotifier" ]; then
        sudo sed -i 's/updateNotifier=.*/updateNotifier=false/' $configs/swarm.cfg
    else
        sudo sed -i 's/updateNotifier=.*/updateNotifier='$updateNotifier'/' $configs/swarm.cfg
    fi

    if [ -z "$theme" ]; then
        sudo sed -i 's/theme=.*/theme="default"/' $configs/swarm.cfg
    else
        sudo sed -i 's/theme=.*/theme="'$theme'"/' $configs/swarm.cfg
    fi

    if [ -z "$swarmAutoUpdate" ]; then
        sudo sed -i 's/swarmAutoUpdate=.*/swarmAutoUpdate=false/' $configs/swarm.cfg
    else
        sudo sed -i 's/swarmAutoUpdate=.*/swarmAutoUpdate='$swarmAutoUpdate'/' $configs/swarm.cfg
    fi

    if [ -z "$nodeUpdate" ]; then
        sudo sed -i 's/nodeUpdate=.*/nodeUpdate=false/' $configs/swarm.cfg
    else
        sudo sed -i 's/nodeUpdate=.*/nodeUpdate='$nodeUpdate'/' $configs/swarm.cfg
    fi

    if [ -z "$keepDb" ]; then
        sudo sed -i 's/keepDb=.*/keepDb=false/' $configs/swarm.cfg
    else
        sudo sed -i 's/keepDb=.*/keepDb='$keepDb'/' $configs/swarm.cfg
    fi

    if [ -z "$checkSync" ]; then
        sudo sed -i 's/checkSync=.*/checkSync=false/' $configs/swarm.cfg
    else
        sudo sed -i 's/checkSync=.*/checkSync='$checkSync'/' $configs/swarm.cfg
    fi    

    if [ -z "$maxLmi" ]; then
        sudo sed -i 's/maxLmi=.*/maxLmi=360/' $configs/swarm.cfg
    else
        sudo sed -i 's/maxLmi=.*/maxLmi='$maxLmi'/' $configs/swarm.cfg
    fi

    if [ -z "$proxyCheck" ]; then
        sudo sed -i 's/proxyCheck=.*/proxyCheck=false/' $configs/swarm.cfg
    else
        sudo sed -i 's/proxyCheck=.*/proxyCheck='$proxyCheck'/' $configs/swarm.cfg
    fi

    if [ -z "$logPruning" ]; then
        sudo sed -i 's/logPruning=.*/logPruning=false/' $configs/swarm.cfg
    else
        sudo sed -i 's/logPruning=.*/logPruning='$logPruning'/' $configs/swarm.cfg
    fi

    if [ -z "$logSize" ]; then
        sudo sed -i 's/logSize=.*/logSize=10/' $configs/swarm.cfg
    else
        sudo sed -i 's/logSize=.*/logSize='$logSize'/' $configs/swarm.cfg
    fi

    if [ -z "$maxDbSize" ]; then
        sudo sed -i 's/maxDbSize=.*/maxDbSize=/' $configs/swarm.cfg
    else
        sudo sed -i 's/maxDbSize=.*/maxDbSize='$maxDbSize'/' $configs/swarm.cfg
    fi

    # Delete Bak file
    rm -rf $configs/swarmCfgBak
fi

####################################################################################################################################

if [ -f "$logs/watchdogBak" ]; then
    source $logs/watchdogBak
    # Updater for watchdog.log
    sudo sed -i 's/statusCounter=.*/statusCounter='$statusCounter'/' $logs/watchdog
    sudo sed -i 's/syncCounter=.*/syncCounter='$syncCounter'/' $logs/watchdog
    sudo sed -i "s,restartDate=.*,restartDate=\"$restartDate\"," $logs/watchdog
    # Delete Bak file
    rm -rf $logs/watchdogBak
fi

####################################################################################################################################

if [ -f "$logs/dbPrunerBak" ]; then
    source $logs/dbPrunerBak
    # Updater for dbpruner.log
    sudo sed -i 's/dbPrunerLock=.*/dbPrunerLock='$dbPrunerLock'/' $logs/dbPruner
    sudo sed -i "s,pruningDate=.*,pruningDate=\"$pruningDate\"," $logs/dbPruner
    # Delete Bak file
    rm -rf $logs/dbPrunerBak
fi


#### REMOVE ALL BAKs
rm -rf $logs/*Bak$ $configs/*Bak$