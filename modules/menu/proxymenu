#!/bin/bash
while [ $counter -lt 1 ]; do
    clear
    CHOICE=$(
        whiptail --title "Proxy Menu" --menu "\nChoose an option" 16 65 0 \
        "1)" "Edit Nginx.cfg" \
        "2)" "Edit auth users" \
        "3)" "Add new auth user" \
        "4)" "Deploy reverse proxy" \
        "5)" "Renew SSL Certificate" 3>&2 2>&1 1>&3
    )
    exitstatus=$?
    if [ "$exitstatus" = "1" ]; then
        counter=1
    fi

    case $CHOICE in
        "1)")
            # Change nginx.cfg
            sudo nano $configs/nginx.cfg
            source $configs/nginx.cfg
        ;;
        "2)")
            # Edit auth user
            if [ -d "/etc/nginx" ]; then
                source $modules/proxy/edituserproxy
            else
                whiptail --title "Proxy Menu" --msgbox "Please install nginx first!" 8 65
            fi
        ;;
        "3)")
            # Add new auth user
            if [ -d "/etc/nginx" ]; then
                source $modules/proxy/adduserproxy
            else
                whiptail --title "Proxy Menu" --msgbox "Please install nginx first!" 8 65
            fi
        ;;
        "4)")
            # Run the nginx module for the proxy
            source $modules/proxy/nginx
        ;;
        "5)")
            # Manual renew certificate if installed
            if [ -f "/etc/letsencrypt/live/$domain/fullchain.pem" ]; then
                sudo certbot renew
            else
                whiptail --title "Proxy Menu" --msgbox "Error! No SSL Certificate installed!" 8 65
            fi
        ;;
    esac
done
counter=0