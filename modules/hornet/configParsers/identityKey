#!/bin/bash

if [ -z "$hornetIdentityKey" ] || [ ! -f "$hornetDir/p2pstore/identity.key" ]; then
    if [ ! -f "$hornetDir/p2pstore/identity.key" ]; then
        (cd $hornetDir ; sudo -u hornet hornet tools p2pidentity-gen)
    fi
    hornetIdentityKey=$(cat $hornetDir/p2pstore/identity.key | sed -n '2 p')
    sudo sed -i 's~^hornetIdentityKey=.*~hornetIdentityKey="'$hornetIdentityKey'"~' $configs/hornet.cfg
fi

parser=$(cat $hornetDir/p2pstore/identity.key | sed -n '2 p')
if [ "$parser" != "$hornetIdentityKey" ]; then
    sed -i '2 s~.*~'$hornetIdentityKey'~' $hornetDir/p2pstore/identity.key
    restartHornet=true
fi