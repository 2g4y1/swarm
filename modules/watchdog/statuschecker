#!/bin/bash
source $swarmlog

if [ "$status" != "active" ]; then
    dt=`date '+%m/%d/%Y %H:%M:%S'`
    sudo systemctl restart hornet
    let statuscounter=$statuscounter+1
    if [ "$statuscounter" -ge "2" ]; then
        if [ "$network" = "mainnet" ]; then
            sudo rm -rf $hornetdir/mainnetdb $hornetdir/snapshots/mainnet
        fi
        if [ "$network" = "comnet" ]; then
            sudo rm -rf $hornetdir/comnetdb $hornetdir/snapshots/comnet
        fi
        if [ "$network" = "devnet" ]; then
            sudo rm -rf $hornetdir/devnetdb $hornetdir/snapshots/devnet
        fi
        statcounter=0
    fi
    sudo systemctl restart hornet
    sudo sed -i 's/statuscounter=.*/statuscounter='$statuscounter'/' $swarmlog
    sudo sed -i 's/restartdate=.*/restartdate=\"'$dt'\"/' $swarmlog
else
    if [ "$statcounter" -gt "0" ]; then
        let statcounter=$statcounter-1
        sudo sed -i 's/statuscounter=.*/statuscounter='$statuscounter'/' $swarmlog
    fi
fi
