#!/bin/bash

if [ "$status" != "active" ]; then
    dt=`date '+%m/%d/%Y %H:%M:%S'`
    sudo systemctl restart hornet
    statcounter="$(cat $swarmdir/log/watchdog.log | sed -n -e '1{p;q}')"
    let statcounter=statcounter+1
    if [ "$statcounter" -gt "2" ]; then
        if [ "$network" = "mainnet" ]; then
            sudo rm -rf $hornetdir/mainnetdb $hornetdir/snapshots/mainnet
        fi
        if [ "$network" = "comnet" ]; then
            sudo rm -rf $hornetdir/comnetdb $hornetdir/snapshots/comnet
        fi
        if [ "$network" = "devnet" ]; then
            sudo rm -rf $hornetdir/devnetdb $hornetdir/snapshots/devnet
        fi
        if [ -f "$swarmdir/log/pruning.log" ]; then
            {
            echo "1"
            echo ""
            } > $swarmdir/log/pruning.log
        fi
        sudo sed -i 's/pruningindex=.*/pruningindex=/' $configs/swarm.cfg
        statcounter=0
    fi
    sudo systemctl restart hornet
    synccounter="$(cat $swarmdir/log/watchdog.log | sed -n -e '2{p;q}')"
    {
    echo $statcounter
    echo $synccounter
    echo $dt
    } > $swarmdir/log/watchdog.log
fi
