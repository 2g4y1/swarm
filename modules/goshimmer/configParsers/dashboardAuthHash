#!/bin/bash

if [ -z "$goshimmerDashboardAuthHash" ]; then
    if [ ! -d "/etc/nginx/goshimmer" ]; then
        sudo mkdir -p /etc/nginx/goshimmer
    else
        sudo htpasswd -bcB /etc/nginx/goshimmer/.htpasswd_dashboard $goshimmerDashboardAuthUsername $goshimmerDashboardAuthPassword
        sudo sed -i 's/^goshimmerDashboardAuthHash=.*/goshimmerDashboardAuthHash="'$goshimmerDashboardAuthHash'"/' $configs/goshimmer.cfg
        if [ -f "/usr/sbin/nginx" ]; then
            sudo systemctl reload nginx > /dev/null 2>&1
        fi
    fi
else
    parser=$(sudo htpasswd -bnB $goshimmerDashboardAuthUsername $goshimmerDashboardAuthPassword)
    if [ "$parser" != "$goshimmerDashboardAuthHash" ]; then
        sudo htpasswd -bcB /etc/nginx/goshimmer/.htpasswd_dashboard $goshimmerDashboardAuthUsername $goshimmerDashboardAuthPassword
        sudo sed -i 's/^goshimmerDashboardAuthHash=.*/goshimmerDashboardAuthHash="'$parser'"/' $configs/goshimmer.cfg
        if [ -f "/usr/sbin/nginx" ]; then
            sudo systemctl reload nginx > /dev/null 2>&1
        fi
    fi
fi
